<html><head><title>Hammock</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="com.pepegar" /><meta name="description" content="Purely functional HTTP client" /><meta name="og:image" content="/hammock/img/poster.png" /><meta name="og:title" content="Hammock" /><meta name="og:site_name" content="Hammock" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Purely functional HTTP client" /><link rel="icon" type="image/png" href="/hammock/img/favicon.png" /><meta name="twitter:title" content="Hammock" /><meta name="twitter:image" content="img/poster.png" /><meta name="twitter:description" content="Purely functional HTTP client" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/hammock/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/hammock/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/hammock/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/hammock/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/hammock/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/hammock/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/hammock/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/hammock/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/hammock/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/hammock/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/hammock/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/hammock/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/hammock/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/hammock/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/hammock/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/hammock/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/hammock/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/hammock/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/hammock/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/hammock/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/hammock/highlight/styles/tomorrow.css" /><link rel="stylesheet" href="/hammock/css/style.css" /><link rel="stylesheet" href="/hammock/css/palette.css" /><link rel="stylesheet" href="/hammock/css/codemirror.css" /><link rel="stylesheet" href="/hammock/css/kazari-style.css" /><link rel="stylesheet" href="/hammock/css/monokai.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/hammock/" class="brand"><div class="brand-wrapper"><span>Hammock</span></div></a></li><li><a href="/hammock/docs.html" class=" active "></a></li><li><a href="/hammock/css/palette.css" class=" active "></a></li><li><a href="/hammock/css/style.css" class=" active "></a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/pepegar/hammock"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/pepegar/hammock"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Hammock Purely functional HTTP client');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Hammock Purely functional HTTP client');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="pepegar" data-github-repo="hammock"><div class="content-wrapper"><section><h1 id="low-level-dsl">Low level DSL</h1>

<p>Imagine you were already using free monads for desiginng your
application:</p>

<p>As always, start with some imports</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats._</span>
<span class="k">import</span> <span class="nn">cats.free._</span>
<span class="k">import</span> <span class="nn">cats.data._</span>
<span class="k">import</span> <span class="nn">cats.effect.Sync</span>
</code></pre>
</div>

<h2 id="algebras">Algebras</h2>

<p>Then, we need to start defining our algebras. Here’s is the algebra
related to logging</p>

<h3 id="log">Log</h3>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">object</span> <span class="nc">Log</span> <span class="o">{</span>
  <span class="k">sealed</span> <span class="k">trait</span> <span class="nc">LogF</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
  <span class="nc">case</span> <span class="k">class</span> <span class="nc">Info</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">LogF</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>
  <span class="k">case</span> <span class="k">class</span> <span class="nc">Error</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">LogF</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>

  <span class="k">class</span> <span class="nc">LogC</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">I</span><span class="k">:</span> <span class="kt">InjectK</span><span class="o">[</span><span class="kt">LogF</span>, <span class="kt">F</span><span class="o">])</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">info</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Free</span><span class="o">.</span><span class="n">inject</span><span class="o">(</span><span class="nc">Info</span><span class="o">(</span><span class="n">msg</span><span class="o">))</span>
    <span class="k">def</span> <span class="n">error</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Free</span><span class="o">.</span><span class="n">inject</span><span class="o">(</span><span class="nc">Error</span><span class="o">(</span><span class="n">msg</span><span class="o">))</span>
  <span class="o">}</span>

  <span class="k">object</span> <span class="nc">LogC</span> <span class="o">{</span>
    <span class="k">implicit</span> <span class="k">def</span> <span class="n">logC</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">I</span><span class="k">:</span> <span class="kt">InjectK</span><span class="o">[</span><span class="kt">LogF</span>, <span class="kt">F</span><span class="o">])</span><span class="k">:</span> <span class="kt">LogC</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LogC</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="n">interp</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="kt">:</span> <span class="kt">Sync</span><span class="o">]</span><span class="k">:</span> <span class="kt">LogF</span> <span class="kt">~&gt;</span> <span class="kt">F</span> <span class="o">=</span> <span class="k">new</span> <span class="o">(</span><span class="nc">LogF</span> <span class="o">~&gt;</span> <span class="n">F</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">logF</span><span class="k">:</span> <span class="kt">LogF</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>  <span class="n">logF</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Info</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Sync</span><span class="o">[</span><span class="kt">F</span><span class="o">].</span><span class="n">delay</span><span class="o">(</span><span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">"[info]: $msg"</span><span class="o">))</span>
      <span class="k">case</span> <span class="nc">Error</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Sync</span><span class="o">[</span><span class="kt">F</span><span class="o">].</span><span class="n">delay</span><span class="o">(</span><span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">"[error]: $msg"</span><span class="o">))</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// defined object Log
</span></code></pre>
</div>

<h3 id="console-io">Console IO</h3>

<p>And this one does IO.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">object</span> <span class="nc">IOEff</span> <span class="o">{</span>

<span class="k">sealed</span> <span class="k">trait</span> <span class="nc">IOF</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
  <span class="nc">case</span> <span class="k">object</span> <span class="nc">Read</span> <span class="k">extends</span> <span class="nc">IOF</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
  <span class="k">case</span> <span class="k">class</span> <span class="nc">Write</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">IOF</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>

  <span class="k">class</span> <span class="nc">IOC</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">I</span><span class="k">:</span> <span class="kt">InjectK</span><span class="o">[</span><span class="kt">IOF</span>, <span class="kt">F</span><span class="o">])</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">read</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Free</span><span class="o">.</span><span class="n">inject</span><span class="o">(</span><span class="nc">Read</span><span class="o">)</span>
    <span class="k">def</span> <span class="n">write</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Free</span><span class="o">.</span><span class="n">inject</span><span class="o">(</span><span class="nc">Write</span><span class="o">(</span><span class="n">str</span><span class="o">))</span>
  <span class="o">}</span>

  <span class="k">object</span> <span class="nc">IOC</span> <span class="o">{</span>
    <span class="k">implicit</span> <span class="k">def</span> <span class="n">ioC</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">I</span><span class="k">:</span> <span class="kt">InjectK</span><span class="o">[</span><span class="kt">IOF</span>, <span class="kt">F</span><span class="o">])</span><span class="k">:</span> <span class="kt">IOC</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">IOC</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="n">interp</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="kt">:</span> <span class="kt">Sync</span><span class="o">]</span><span class="k">:</span> <span class="kt">IOF</span> <span class="kt">~&gt;</span> <span class="kt">F</span> <span class="o">=</span> <span class="k">new</span> <span class="o">(</span><span class="nc">IOF</span> <span class="o">~&gt;</span> <span class="n">F</span><span class="o">)</span> <span class="o">{</span>
	<span class="c1">// this could be implemented using scala.io.StdIn, for example
</span>	<span class="k">def</span> <span class="n">readline</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"line read!"</span>

    <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">ioF</span><span class="k">:</span> <span class="kt">IOF</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="n">ioF</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Read</span> <span class="k">=&gt;</span> <span class="nc">Sync</span><span class="o">[</span><span class="kt">F</span><span class="o">].</span><span class="n">delay</span><span class="o">(</span><span class="n">readline</span><span class="o">)</span>
      <span class="k">case</span> <span class="nc">Write</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Sync</span><span class="o">[</span><span class="kt">F</span><span class="o">].</span><span class="n">delay</span><span class="o">(</span><span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">"$msg"</span><span class="o">))</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="combining-our-effects">Combining our effects</h2>

<p>And finally, we should need to build everything together. For that
purpose, we will need a <code class="highlighter-rouge">EitherK</code>. This datatype basically tells the
typesystem about our effects, saying that our <code class="highlighter-rouge">Eff</code> type can be either
a <code class="highlighter-rouge">Log</code> or a <code class="highlighter-rouge">IO</code> value.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">object</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">IOEff._</span>
  <span class="k">import</span> <span class="nn">Log._</span>

  <span class="k">type</span> <span class="kt">Eff</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">EitherK</span><span class="o">[</span><span class="kt">LogF</span>, <span class="kt">IOF</span>, <span class="kt">A</span><span class="o">]</span>

  <span class="k">val</span> <span class="n">name</span> <span class="k">=</span> <span class="s">"pepegar"</span>

  <span class="k">def</span> <span class="n">program</span><span class="o">(</span><span class="k">implicit</span> <span class="nc">Log</span><span class="k">:</span> <span class="kt">LogC</span><span class="o">[</span><span class="kt">Eff</span><span class="o">],</span> <span class="nc">IO</span><span class="k">:</span> <span class="kt">IOC</span><span class="o">[</span><span class="kt">Eff</span><span class="o">])</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
    <span class="c1">// this dinamically generated documentation, we cannot ask for input, but we should do `name &lt;- IO.read`
</span>    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nc">Log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="n">s</span><span class="s">"name was $name"</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nc">IO</span><span class="o">.</span><span class="n">write</span><span class="o">(</span><span class="n">s</span><span class="s">"hello $name"</span><span class="o">)</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">name</span>

  <span class="k">def</span> <span class="n">interp</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="kt">:</span> <span class="kt">Sync</span><span class="o">]</span><span class="k">:</span> <span class="kt">Eff</span> <span class="kt">~&gt;</span> <span class="kt">F</span> <span class="o">=</span> <span class="nc">Log</span><span class="o">.</span><span class="n">interp</span> <span class="n">or</span> <span class="nc">IOEff</span><span class="o">.</span><span class="n">interp</span>
<span class="o">}</span>
</code></pre>
</div>

<p>You could use this as follows:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">cats.effect.IO</span>
<span class="k">import</span> <span class="nn">cats.effect.IO</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">App</span><span class="o">.</span><span class="n">program</span> <span class="n">foldMap</span> <span class="nc">App</span><span class="o">.</span><span class="n">interp</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>
<span class="n">res0</span><span class="k">:</span> <span class="kt">cats.effect.IO</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">IO$1499324561</span>
</code></pre>
</div>

<h2 id="interleaving-hammock-in-a-free-program">Interleaving Hammock in a Free program</h2>

<p>Normally, extending this kind of programs is a bit cumbersome because
you need to write all the boilerplate to embed a library into a
free-based architecture, and then use it yourself.  However, with
Hammock, you can import <code class="highlighter-rouge">hammock.free._</code> and enjoy:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">object</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">hammock.Uri</span>
  <span class="k">import</span> <span class="nn">IOEff._</span>
  <span class="k">import</span> <span class="nn">Log._</span>
  <span class="k">import</span> <span class="nn">cats._</span>
  <span class="k">import</span> <span class="nn">cats.effect.IO</span>
  <span class="k">import</span> <span class="nn">hammock.free.algebra._</span>
  <span class="k">import</span> <span class="nn">hammock.jvm.free._</span>

  <span class="k">type</span> <span class="kt">Eff1</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">EitherK</span><span class="o">[</span><span class="kt">LogF</span>, <span class="kt">IOF</span>, <span class="kt">A</span><span class="o">]</span>
  <span class="k">type</span> <span class="kt">Eff</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">EitherK</span><span class="o">[</span><span class="kt">HttpRequestF</span>, <span class="kt">Eff1</span>, <span class="kt">A</span><span class="o">]</span>

  <span class="k">def</span> <span class="n">program</span><span class="o">(</span><span class="k">implicit</span>
    <span class="nc">Log</span><span class="k">:</span> <span class="kt">LogC</span><span class="o">[</span><span class="kt">Eff</span><span class="o">],</span>
    <span class="nc">IO</span><span class="k">:</span> <span class="kt">IOC</span><span class="o">[</span><span class="kt">Eff</span><span class="o">],</span>
    <span class="nc">Hammock</span><span class="k">:</span> <span class="kt">HttpRequestC</span><span class="o">[</span><span class="kt">Eff</span><span class="o">]</span>
  <span class="o">)</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nc">IO</span><span class="o">.</span><span class="n">write</span><span class="o">(</span><span class="s">"What's the ID?"</span><span class="o">)</span>
    <span class="n">id</span> <span class="k">=</span> <span class="s">"4"</span> <span class="c1">// for the sake of docs, lets hardcode this... It should be `id &lt;- IO.read`
</span>    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nc">Log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="n">s</span><span class="s">"id was $id"</span><span class="o">)</span>
    <span class="n">response</span> <span class="k">&lt;-</span> <span class="nc">Hammock</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="nc">Uri</span><span class="o">.</span><span class="n">unsafeParse</span><span class="o">(</span><span class="n">s</span><span class="s">"https://jsonplaceholder.typicode.com/users?id=${id.toString}"</span><span class="o">),</span> <span class="nc">Map</span><span class="o">())</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">response</span>

  <span class="k">def</span> <span class="n">interp1</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="kt">:</span> <span class="kt">Sync</span><span class="o">]</span><span class="k">:</span> <span class="kt">Eff1</span> <span class="kt">~&gt;</span> <span class="kt">F</span> <span class="o">=</span> <span class="nc">Log</span><span class="o">.</span><span class="n">interp</span> <span class="n">or</span> <span class="nc">IOEff</span><span class="o">.</span><span class="n">interp</span>
  <span class="k">def</span> <span class="n">interp</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="kt">:</span> <span class="kt">Sync</span><span class="o">]</span><span class="k">:</span> <span class="kt">Eff</span> <span class="kt">~&gt;</span> <span class="kt">F</span> <span class="o">=</span> <span class="nc">Interpreter</span><span class="o">[</span><span class="kt">F</span><span class="o">].</span><span class="n">trans</span> <span class="n">or</span> <span class="n">interp1</span> <span class="c1">// interpret Hammock's effects
</span><span class="o">}</span>
</code></pre>
</div>

<h3 id="result">Result</h3>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="nc">App</span><span class="o">.</span><span class="n">program</span> <span class="n">foldMap</span> <span class="nc">App</span><span class="o">.</span><span class="n">interp</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>
<span class="n">result</span><span class="k">:</span> <span class="kt">cats.effect.IO</span><span class="o">[</span><span class="kt">hammock.HttpResponse</span><span class="o">]</span> <span class="k">=</span> <span class="nc">IO$1894642756</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">result</span><span class="o">.</span><span class="n">unsafeRunSync</span>
<span class="nc">What</span><span class="ss">'s </span><span class="n">the</span> <span class="nc">ID</span><span class="o">?</span>
<span class="o">[</span><span class="kt">info</span><span class="o">]</span><span class="k">:</span> <span class="kt">id</span> <span class="kt">was</span> <span class="err">4</span>
<span class="kt">res1:</span> <span class="kt">hammock.HttpResponse</span> <span class="o">=</span> <span class="nc">HttpResponse</span><span class="o">(</span><span class="nc">Status</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span><span class="nc">OK</span><span class="o">,</span><span class="nc">OK</span><span class="o">),</span><span class="nc">Map</span><span class="o">(</span><span class="nc">Vary</span> <span class="o">-&gt;</span> <span class="nc">Origin</span><span class="o">,</span> <span class="nc">Accept</span><span class="o">-</span><span class="nc">Encoding</span><span class="o">,</span> <span class="nc">Transfer</span><span class="o">-</span><span class="nc">Encoding</span> <span class="o">-&gt;</span> <span class="n">chunked</span><span class="o">,</span> <span class="nc">Server</span> <span class="o">-&gt;</span> <span class="n">cloudflare</span><span class="o">,</span> <span class="nc">Access</span><span class="o">-</span><span class="nc">Control</span><span class="o">-</span><span class="nc">Allow</span><span class="o">-</span><span class="nc">Credentials</span> <span class="o">-&gt;</span> <span class="kc">true</span><span class="o">,</span> <span class="nc">Etag</span> <span class="o">-&gt;</span> <span class="n">W</span><span class="o">/</span><span class="s">"23f-dNckueF2Qy9kPGGjhoIfeuBW8rg"</span><span class="o">,</span> <span class="nc">Expires</span> <span class="o">-&gt;</span> <span class="nc">Tue</span><span class="o">,</span> <span class="mi">19</span> <span class="nc">Dec</span> <span class="mi">2017</span> <span class="mi">20</span><span class="k">:</span><span class="err">47</span><span class="kt">:</span><span class="err">46</span> <span class="kt">GMT</span><span class="o">,</span> <span class="nc">Connection</span> <span class="o">-&gt;</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span><span class="o">,</span> <span class="nc">CF</span><span class="o">-</span><span class="nc">Cache</span><span class="o">-</span><span class="nc">Status</span> <span class="o">-&gt;</span> <span class="nc">REVALIDATED</span><span class="o">,</span> <span class="nc">Cache</span><span class="o">-</span><span class="nc">Control</span> <span class="o">-&gt;</span> <span class="n">public</span><span class="o">,</span> <span class="n">max</span><span class="o">-</span><span class="n">age</span><span class="k">=</span><span class="mi">14400</span><span class="o">,</span> <span class="n">X</span><span class="o">-</span><span class="nc">Content</span><span class="o">-</span><span class="nc">Type</span><span class="o">-</span><span class="nc">Options</span> <span class="o">-&gt;</span> <span class="n">nosniff</span><span class="o">,</span> <span class="nc">Via</span> <span class="o">-&gt;</span> <span class="mf">1.1</span> <span class="n">vegur</span><span class="o">,</span> <span class="nc">Content</span><span class="o">-</span><span class="nc">Type</span> <span class="o">-&gt;</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="o">;</span> <span class="n">charset</span><span class="k">=</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="o">,</span> <span class="nc">Pragma</span> <span class="o">-&gt;</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span><span class="o">,</span> <span class="nc">Date</span> <span class="o">-&gt;</span> <span class="nc">Tue</span><span class="o">,</span> <span class="mi">19</span> <span class="nc">Dec</span> <span class="mi">2017</span> <span class="mi">16</span><span class="k">:</span><span class="err">47</span><span class="kt">:</span><span class="err">46</span> <span class="kt">GMT</span><span class="o">,</span> <span class="nc">CF</span><span class="o">-</span><span class="nc">RAY</span> <span class="o">-&gt;</span> <span class="mi">3</span><span class="n">cfbd876ebf634be</span><span class="o">-</span><span class="nc">LHR</span><span class="o">,</span> <span class="nc">Set</span><span class="o">-</span><span class="nc">Cookie</span> <span class="o">-&gt;</span> <span class="nc">__cfduid</span><span class="k">=</span><span class="n">dd21a7b59bed5c9453f15cb059a54b5b51513702065</span><span class="o">;</span> <span class="n">expires</span><span class="k">=</span><span class="nc">Wed</span><span class="o">,</span> <span class="mi">19</span><span class="o">-</span><span class="nc">Dec</span><span class="o">-</span><span class="mi">18</span> <span class="mi">16</span><span class="k">:</span><span class="err">47</span><span class="kt">:</span><span class="err">45</span> <span class="kt">GMT</span><span class="o">;</span> <span class="n">path</span><span class="o">=/;</span> <span class="n">domain</span><span class="o">=.</span><span class="n">typicode</span><span class="o">.</span><span class="n">com</span><span class="o">;</span> <span class="nc">HttpOnly</span><span class="o">,</span> <span class="n">X</span><span class="o">-</span><span class="nc">Powered</span><span class="o">-</span><span class="nc">By</span> <span class="o">-&gt;</span> <span class="nc">Express</span><span class="o">),</span><span class="nc">StringEntity</span><span class="o">([</span>  <span class="o">{</span>    <span class="err">"</span><span class="kt">id</span><span class="err">"</span><span class="kt">:</span> <span class="err">4</span>,   <span class="kt">...</span>
</code></pre>
</div>

<h1 id="high-level-dsl">High level DSL</h1>

<p>This package provides a high level DSL to use Hammock without the
hassle of dealing with Free monads, interpreters, and so on.</p>

<p>Of course, you’re still able to use lo level API if needed to create
your requests.</p>

<h2 id="example-of-use">Example of use</h2>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">hammock._</span>
<span class="c1">// import hammock._
</span>
<span class="k">import</span> <span class="nn">hammock.jvm.free.Interpreter</span>
<span class="c1">// import hammock.jvm.free.Interpreter
</span>
<span class="k">import</span> <span class="nn">hammock.hi._</span>
<span class="c1">// import hammock.hi._
</span>
<span class="k">import</span> <span class="nn">hammock.hi.dsl._</span>
<span class="c1">// import hammock.hi.dsl._
</span>
<span class="k">import</span> <span class="nn">cats._</span>
<span class="c1">// import cats._
</span>
<span class="k">import</span> <span class="nn">cats.implicits._</span>
<span class="c1">// import cats.implicits._
</span>
<span class="k">import</span> <span class="nn">cats.effect.IO</span>
<span class="c1">// import cats.effect.IO
</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">interp</span> <span class="k">=</span> <span class="nc">Interpreter</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>
<span class="c1">// interp: hammock.jvm.free.Interpreter[cats.effect.IO] = hammock.jvm.free.Interpreter@6530bb1a
</span>
<span class="k">val</span> <span class="n">opts</span> <span class="k">=</span> <span class="o">(</span><span class="n">header</span><span class="o">(</span><span class="s">"user"</span> <span class="o">-&gt;</span> <span class="s">"pepegar"</span><span class="o">)</span> <span class="o">&amp;&gt;</span> <span class="n">cookie</span><span class="o">(</span><span class="nc">Cookie</span><span class="o">(</span><span class="s">"track"</span><span class="o">,</span> <span class="s">"a lot"</span><span class="o">)))(</span><span class="nc">Opts</span><span class="o">.</span><span class="n">empty</span><span class="o">)</span>
<span class="c1">// opts: hammock.hi.Opts = Opts(None,Map(user -&gt; pepegar),Some(List(Cookie(track,a lot,None,None,None,None,None,None,None,None))))
</span>
<span class="k">val</span> <span class="n">response</span> <span class="k">=</span> <span class="nc">Hammock</span><span class="o">.</span><span class="n">getWithOpts</span><span class="o">(</span><span class="nc">Uri</span><span class="o">.</span><span class="n">unsafeParse</span><span class="o">(</span><span class="s">"http://httpbin.org/get"</span><span class="o">),</span> <span class="n">opts</span><span class="o">).</span><span class="n">exec</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>
<span class="c1">// response: cats.effect.IO[hammock.HttpResponse] = IO$243480930
</span></code></pre>
</div>

<h2 id="opts">Opts</h2>

<p>The high level DSL uses a <code class="highlighter-rouge">Opts</code> datatype for describing the request.
This <code class="highlighter-rouge">Opts</code> type is later compiled by the <code class="highlighter-rouge">withOpts</code> methods to the
<code class="highlighter-rouge">Free</code> representation of the request.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Opts</span><span class="o">(</span>
  <span class="n">auth</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Auth</span><span class="o">],</span>
  <span class="n">headers</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">],</span>
  <span class="n">cookies</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Cookie</span><span class="o">]])</span>
</code></pre>
</div>

<p>All the combinators for manipulating the <code class="highlighter-rouge">Opts</code> type return a value of
the type <code class="highlighter-rouge">Opts =&gt; Opts</code>, so you can combine directly via the <code class="highlighter-rouge">andThen</code>
combinator of <code class="highlighter-rouge">Function1</code>.  Also, Hammock provides a helper combinator
<code class="highlighter-rouge">&amp;&gt;</code> for composing <code class="highlighter-rouge">Opts =&gt; Opts</code> functions.</p>

<h3 id="combinators-that-operate-on-opts">Combinators that operate on <code class="highlighter-rouge">Opts</code></h3>

<table>
  <thead>
    <tr>
      <th>signature</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">auth(a: Auth): Opts =&gt; Opts</code></td>
      <td>Sets the <code class="highlighter-rouge">auth</code> field in opts</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">cookies_!(cookies: List[Cookie]): Opts =&gt; Opts</code></td>
      <td>Substitutes the current value of <code class="highlighter-rouge">cookies</code> in the given <code class="highlighter-rouge">Opts</code> by its param.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">cookies(cookies: List[Cookie]): Opts =&gt; Opts</code></td>
      <td>Appends the given cookies to the current value of <code class="highlighter-rouge">cookies</code>.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">cookie(cookie: Cookie): Opts =&gt; Opts</code></td>
      <td>Adds the given <code class="highlighter-rouge">Cookie</code> to the <code class="highlighter-rouge">Opts</code> value.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">headers_!(headers: Map[String, String]): Opts =&gt; Opts</code></td>
      <td>Sets the <code class="highlighter-rouge">headers</code>.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">headers(headers: Map[String, String]): Opts =&gt; Opts</code></td>
      <td>Appends the given <code class="highlighter-rouge">headers</code> to the former ones.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">header(header: (String, String)): Opts =&gt; Opts</code></td>
      <td>Appends current <code class="highlighter-rouge">header</code> (a <code class="highlighter-rouge">(String, String)</code> value) to the headers map.</td>
    </tr>
  </tbody>
</table>

<p>Here’s an example of how can you use the high level DSL:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">req</span> <span class="k">=</span> <span class="o">{</span>
  <span class="n">auth</span><span class="o">(</span><span class="nc">Auth</span><span class="o">.</span><span class="nc">BasicAuth</span><span class="o">(</span><span class="s">"pepegar"</span><span class="o">,</span> <span class="s">"p4ssw0rd"</span><span class="o">))</span> <span class="o">&amp;&gt;</span>
    <span class="n">cookie</span><span class="o">(</span><span class="nc">Cookie</span><span class="o">(</span><span class="s">"track"</span><span class="o">,</span> <span class="s">"A lot"</span><span class="o">))</span> <span class="o">&amp;&gt;</span>
    <span class="n">header</span><span class="o">(</span><span class="s">"user"</span> <span class="o">-&gt;</span> <span class="s">"potatoman"</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// req: hammock.hi.Opts =&gt; hammock.hi.Opts = scala.Function1$$Lambda$607/2076627578@613d3a51
</span></code></pre>
</div>

<p>You can also use <a href="https://github.com/julientruffaut/monocle"><code class="highlighter-rouge">Monocle</code></a>’s optics to describe and modify your
requests.  Most datatypes in Hammock provide sensible optics that will
work out of the box, and you can combine them with the ones provided
in <a href="https://github.com/julientruffaut/monocle"><code class="highlighter-rouge">Monocle</code></a>:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="c1">// import stuff
</span><span class="k">import</span> <span class="nn">hammock.hi._</span><span class="o">,</span> <span class="n">hammock</span><span class="o">.</span><span class="n">hi</span><span class="o">.</span><span class="n">dsl</span><span class="o">.</span><span class="k">_</span> <span class="o">,</span> <span class="n">monocle</span><span class="o">.</span><span class="k">_</span><span class="o">,</span> <span class="n">monocle</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="k">_</span>
<span class="c1">// import hammock.hi._
// import hammock.hi.dsl._
// import monocle._
// import monocle.function.all._
</span>
<span class="c1">// imagine that we have the following Opts value
</span><span class="k">val</span> <span class="n">opts</span> <span class="k">=</span> <span class="o">(</span><span class="n">auth</span><span class="o">(</span><span class="nc">Auth</span><span class="o">.</span><span class="nc">BasicAuth</span><span class="o">(</span><span class="s">"pepe"</span><span class="o">,</span> <span class="s">"password"</span><span class="o">))</span> <span class="o">&amp;&gt;</span> <span class="n">headers</span><span class="o">(</span><span class="nc">Map</span><span class="o">(</span><span class="s">"X-Correlation-Id"</span> <span class="o">-&gt;</span> <span class="s">"234"</span><span class="o">))</span> <span class="o">&amp;&gt;</span> <span class="n">cookies</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="nc">Cookie</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">))))(</span><span class="nc">Opts</span><span class="o">.</span><span class="n">empty</span><span class="o">)</span>
<span class="c1">// opts: hammock.hi.Opts = Opts(Some(BasicAuth(pepe,password)),Map(X-Correlation-Id -&gt; 234),Some(List(Cookie(a,b,None,None,None,None,None,None,None,None))))
</span>
<span class="c1">// Since optics compose nicely, we can focus on
// the first value of the first cookie found in the
// cookie list, for example:
</span>
<span class="nc">Opts</span><span class="o">.</span><span class="n">cookiesOpt</span> <span class="n">composeOptional</span> <span class="n">index</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="n">composeLens</span> <span class="nc">Cookie</span><span class="o">.</span><span class="n">value</span>
<span class="c1">// res8: monocle.POptional[hammock.hi.Opts,hammock.hi.Opts,String,String] = monocle.POptional$$anon$2@6f0cde1e
</span>
<span class="c1">// also you can use the symbolic operators for that :D
</span><span class="nc">Opts</span><span class="o">.</span><span class="n">cookiesOpt</span> <span class="o">^|-?</span> <span class="n">index</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">^|-&gt;</span> <span class="nc">Cookie</span><span class="o">.</span><span class="n">value</span>
<span class="c1">// res10: monocle.POptional[hammock.hi.Opts,hammock.hi.Opts,String,String] = monocle.POptional$$anon$2@d102516
</span>
<span class="c1">// and then, use the optics machinery at your will, for example for getting the focus
</span><span class="o">(</span><span class="nc">Opts</span><span class="o">.</span><span class="n">cookiesOpt</span> <span class="o">^|-?</span> <span class="n">index</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">^|-&gt;</span> <span class="nc">Cookie</span><span class="o">.</span><span class="n">value</span><span class="o">).</span><span class="n">getOption</span><span class="o">(</span><span class="n">opts</span><span class="o">)</span>
<span class="c1">// res12: Option[String] = Some(b)
</span>
<span class="c1">// or modifying it!
</span><span class="o">(</span><span class="nc">Opts</span><span class="o">.</span><span class="n">cookiesOpt</span> <span class="o">^|-?</span> <span class="n">index</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">^|-&gt;</span> <span class="nc">Cookie</span><span class="o">.</span><span class="n">value</span><span class="o">).</span><span class="n">set</span><span class="o">(</span><span class="s">"newValue"</span><span class="o">)(</span><span class="n">opts</span><span class="o">)</span>
<span class="c1">// res14: hammock.hi.Opts = Opts(Some(BasicAuth(pepe,password)),Map(X-Correlation-Id -&gt; 234),Some(List(Cookie(a,newValue,None,None,None,None,None,None,None,None))))
</span></code></pre>
</div>

<h4 id="authentication">Authentication</h4>

<p>There are a number of authentication headers already implemented in
Hammock:</p>

<ul>
  <li><strong>Basic auth</strong> (<code class="highlighter-rouge">Auth.BasicAuth(user: String, pass: String)</code>): Authenticate with user and password.</li>
  <li><strong>OAuth2 Bearer token</strong> (<code class="highlighter-rouge">Auth.OAuth2Bearer(token: String)</code>): Authenticate with an OAuth2 Bearer
token. This is treated by many services like a user/password pair</li>
  <li><strong>OAuth2 token</strong> (<code class="highlighter-rouge">Auth.OAuth2Token(token: String)</code>): This is a <em>not really standard</em> bearer token.
Will be treated by services as user/password.</li>
</ul>

<h4 id="cookies">Cookies</h4>

<p>Cookies in Hammock are represented by the <code class="highlighter-rouge">Cookie</code> data type:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Cookie</span><span class="o">(</span>
  <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="n">value</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="n">expires</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Date</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
  <span class="n">maxAge</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
  <span class="n">domain</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
  <span class="n">path</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
  <span class="n">secure</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
  <span class="n">httpOnly</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
  <span class="n">sameSite</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">SameSite</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
  <span class="n">custom</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">)</span>
</code></pre>
</div>

<p>In its companion object there are optics for all the
fields. <code class="highlighter-rouge">Cookie.name</code> and <code class="highlighter-rouge">Cookie.value</code> are <code class="highlighter-rouge">Lens</code>es that allow to
focus on one particular field of the structure.</p>

<p>As you can see most of the behaviour of the cookie can be handled by
the type itself.  For example, adding a <code class="highlighter-rouge">MaxAge</code> setting to a cookie
is just matter of doing:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">cookie</span> <span class="k">=</span> <span class="nc">Cookie</span><span class="o">(</span><span class="s">"_ga"</span><span class="o">,</span> <span class="s">"werwer"</span><span class="o">)</span>
<span class="c1">// cookie: hammock.hi.Cookie = Cookie(_ga,werwer,None,None,None,None,None,None,None,None)
</span>
<span class="nc">Cookie</span><span class="o">.</span><span class="n">maxAge</span><span class="o">.</span><span class="n">set</span><span class="o">(</span><span class="nc">Some</span><span class="o">(</span><span class="mi">234</span><span class="o">))(</span><span class="n">cookie</span><span class="o">)</span>
<span class="c1">// res15: hammock.hi.Cookie = Cookie(_ga,werwer,None,Some(234),None,None,None,None,None,None)
</span></code></pre>
</div>

<h4 id="headers">Headers</h4>

<p>Headers in the <code class="highlighter-rouge">Opts</code> type are represented by a <code class="highlighter-rouge">Map[String, String]</code>.
In this field, you normally want to put all the headers that are not
strictly cookies or authentication header.</p>

<h1 id="codecs">Codecs</h1>

<p>Hammock uses a typeclass <code class="highlighter-rouge">Codec[A]</code> for encoding request bodies and
decoding response contents.  Its signature is the following:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import hammock.CodecException

trait Codec[A] {
  def encode(a: A): String
  def decode(str: String): Either[CodecException, A]
}
</code></pre>
</div>

<p>Currently, this interface is implemented for <code class="highlighter-rouge">circe</code> codecs, so you
can just grab <code class="highlighter-rouge">hammock-circe</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>libraryDependencies += "hammock" %% "hammock-circe" % "0.7.1"
</code></pre>
</div>

<p>And use it directly:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">hammock._</span>
<span class="c1">// import hammock._
</span>
<span class="k">import</span> <span class="nn">hammock.circe._</span>
<span class="c1">// import hammock.circe._
</span>
<span class="k">import</span> <span class="nn">hammock.circe.implicits._</span>
<span class="c1">// import hammock.circe.implicits._
</span>
<span class="k">import</span> <span class="nn">io.circe._</span>
<span class="c1">// import io.circe._
</span>
<span class="k">import</span> <span class="nn">io.circe.generic.auto._</span>
<span class="c1">// import io.circe.generic.auto._
</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">MyClass</span><span class="o">(</span><span class="n">stringField</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">intField</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
<span class="c1">// defined class MyClass
</span>
<span class="nc">Codec</span><span class="o">[</span><span class="kt">MyClass</span><span class="o">].</span><span class="n">decode</span><span class="o">(</span><span class="nc">Entity</span><span class="o">.</span><span class="nc">StringEntity</span><span class="o">(</span><span class="s">"""{"stringField": "This is Hammock!", "intField": 33}"""</span><span class="o">))</span>
<span class="c1">// res16: Either[hammock.CodecException,MyClass] = Right(MyClass(This is Hammock!,33))
</span>
<span class="nc">Codec</span><span class="o">[</span><span class="kt">MyClass</span><span class="o">].</span><span class="n">decode</span><span class="o">(</span><span class="nc">Entity</span><span class="o">.</span><span class="nc">StringEntity</span><span class="o">(</span><span class="s">"this is not a valid json"</span><span class="o">))</span>
<span class="c1">// res17: Either[hammock.CodecException,MyClass] = Left(hammock.CodecException: expected true got t (line 1, column 1))
</span>
<span class="nc">Codec</span><span class="o">[</span><span class="kt">MyClass</span><span class="o">].</span><span class="n">encode</span><span class="o">(</span><span class="nc">MyClass</span><span class="o">(</span><span class="s">"hello dolly"</span><span class="o">,</span> <span class="mi">99</span><span class="o">))</span>
<span class="c1">// res18: hammock.Entity = StringEntity({"stringField":"hello dolly","intField":99},hammock.ContentType$$anon$1@28e98299)
</span>
<span class="c1">// Also, you can use Codec's syntax as follows:
</span>
<span class="k">import</span> <span class="nn">Codec._</span>
<span class="c1">// import Codec._
</span>
<span class="nc">Entity</span><span class="o">.</span><span class="nc">StringEntity</span><span class="o">(</span><span class="s">"""{"stringField": "This is Hammock!", "intField": 33}"""</span><span class="o">).</span><span class="n">decode</span><span class="o">[</span><span class="kt">MyClass</span><span class="o">]</span>
<span class="c1">// res21: Either[hammock.CodecException,MyClass] = Right(MyClass(This is Hammock!,33))
</span>
<span class="nc">Entity</span><span class="o">.</span><span class="nc">StringEntity</span><span class="o">(</span><span class="s">"this is not a valid json"</span><span class="o">).</span><span class="n">decode</span><span class="o">[</span><span class="kt">MyClass</span><span class="o">]</span>
<span class="c1">// res22: Either[hammock.CodecException,MyClass] = Left(hammock.CodecException: expected true got t (line 1, column 1))
</span>
<span class="nc">MyClass</span><span class="o">(</span><span class="s">"hello dolly"</span><span class="o">,</span> <span class="mi">99</span><span class="o">).</span><span class="n">encode</span>
<span class="c1">// res23: hammock.Entity = StringEntity({"stringField":"hello dolly","intField":99},hammock.ContentType$$anon$1@28e98299)
</span></code></pre>
</div>

<p>Also, if you use any other library for serialization, you can just
implement the <code class="highlighter-rouge">Codec</code> typeclass with it and provide the implicit so
Hammock can use it.</p>

<h1 id="akka-http-integration">Akka-HTTP integration</h1>

<p>hammock supports using akka-http as an interpreter:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">_root_.akka.actor.ActorSystem</span>
<span class="c1">// import _root_.akka.actor.ActorSystem
</span>
<span class="k">import</span> <span class="nn">_root_.akka.http.scaladsl._</span>
<span class="c1">// import _root_.akka.http.scaladsl._
</span>
<span class="k">import</span> <span class="nn">_root_.akka.stream.ActorMaterializer</span>
<span class="c1">// import _root_.akka.stream.ActorMaterializer
</span>
<span class="k">import</span> <span class="nn">cats.effect.IO</span>
<span class="c1">// import cats.effect.IO
</span>
<span class="k">import</span> <span class="nn">hammock._</span>
<span class="c1">// import hammock._
</span>
<span class="k">import</span> <span class="nn">hammock.akka.AkkaInterpreter</span>
<span class="c1">// import hammock.akka.AkkaInterpreter
</span>
<span class="k">import</span> <span class="nn">hammock.circe.implicits._</span>
<span class="c1">// import hammock.circe.implicits._
</span>
<span class="k">import</span> <span class="nn">hammock.hi._</span>
<span class="c1">// import hammock.hi._
</span>
<span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext</span>
<span class="c1">// import scala.concurrent.ExecutionContext
</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="s">"hammock-actor-system"</span><span class="o">)</span>
<span class="c1">// system: akka.actor.ActorSystem = akka://hammock-actor-system
</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">mat</span> <span class="k">=</span> <span class="nc">ActorMaterializer</span><span class="o">()</span>
<span class="c1">// mat: akka.stream.ActorMaterializer = ActorMaterializerImpl(akka://hammock-actor-system,ActorMaterializerSettings(4,16,,&lt;function1&gt;,StreamSubscriptionTimeoutSettings(CancelTermination,5000 milliseconds),false,1000,1000,false,true),akka.dispatch.Dispatchers@b6a96c,Actor[akka://hammock-actor-system/user/StreamSupervisor-0#-906078136],false,akka.stream.impl.SeqActorNameImpl@b0105e3)
</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">ec</span> <span class="k">=</span> <span class="nc">ExecutionContext</span><span class="o">.</span><span class="nc">Implicits</span><span class="o">.</span><span class="n">global</span>
<span class="c1">// ec: scala.concurrent.ExecutionContext = scala.concurrent.impl.ExecutionContextImpl@764417d6
</span>
<span class="k">val</span> <span class="n">httpExt</span><span class="k">:</span> <span class="kt">HttpExt</span> <span class="o">=</span> <span class="nc">Http</span><span class="o">()</span>
<span class="c1">// httpExt: akka.http.scaladsl.HttpExt = akka.http.scaladsl.HttpExt@3a51a13a
</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">interp</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">AkkaInterpreter</span><span class="o">[</span><span class="kt">IO</span><span class="o">](</span><span class="n">httpExt</span><span class="o">)</span>
<span class="c1">// interp: hammock.akka.AkkaInterpreter[cats.effect.IO] = hammock.akka.AkkaInterpreter@5df5c322
</span>
<span class="k">val</span> <span class="n">response</span> <span class="k">=</span> <span class="nc">Hammock</span><span class="o">.</span><span class="n">getWithOpts</span><span class="o">(</span><span class="nc">Uri</span><span class="o">.</span><span class="n">unsafeParse</span><span class="o">(</span><span class="s">"https://api.fidesmo.com/apps"</span><span class="o">),</span> <span class="nc">Opts</span><span class="o">.</span><span class="n">empty</span><span class="o">).</span><span class="n">exec</span><span class="o">[</span><span class="kt">IO</span><span class="o">].</span><span class="n">as</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]].</span><span class="n">unsafeRunSync</span>
<span class="c1">// response: List[String] = List(0cdc651e, 42286d75, 4f97a2e9, 54bf6aa9, 61b4b03d, 61fc54d5, 94c3cd60, dd69cf53, fc6de645)
</span>
<span class="n">system</span><span class="o">.</span><span class="n">shutdown</span><span class="o">()</span>
<span class="c1">// warning: there was one deprecation warning (since 2.4); for details, enable `:setting -deprecation' or `:replay -deprecation'
</span></code></pre>
</div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/hammock/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="/hammock/js/automenu.js"></script><script>((window.gitter = {}).chat = {}).options = {
room: 'pepegar/hammock'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/hammock/js/main.js"></script><script src="/hammock/js/kazari.js"></script><script>
$(document).ready(function() {
	kazari.KazariPlugin().decorateCode('https://scala-evaluator-212.herokuapp.com/eval', 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.S2F6YXJp.Jl2eqMfw8IakJF93PjxTbrf-8YUJgX5OoOfy5JHE8Yw', '', 'monokai')
})
    </script></body></html>